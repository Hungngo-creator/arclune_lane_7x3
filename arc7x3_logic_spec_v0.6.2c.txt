ARC LUNE LANE 7×3 — LOGIC SPEC v0.6.2c (no code)
================================================

Mục tiêu: gom quy ước đã chốt từ cuộc thảo luận + “các lưu ý…” (Cly) và thống nhất các chỗ dễ lệch. File này làm chuẩn để code PR-2 trở đi.

0) Từ khoá & viết tắt
- Ô/buồng: cell trên lưới 7×3 (cột c=0..6, hàng r=0..2; r=0 là top, r=1 mid, r=2 bot).
- Lane: theo cột (trên hình, mỗi hàng 3 ô xem như 1 lane con).
- Ally: phe trái (cột 0..2). Midline: cột 3. Enemy: phe phải (cột 4..6).
- Turn: lượt hành động theo thứ tự cố định 1→9 như hình bạn đánh số (SPD KHÔNG thay đổi thứ tự này). Sau 9 ô bên A xong thì đến 9 ô bên B.
- SPD (Speed): không chen turn, chỉ tạo “ngân sách follow‑up” trong lượt.
- Aether (AE): tài nguyên để dùng kỹ năng và/hoặc Ultimate. AEmax, AEregen/s.

1) Bản đồ & thứ tự hành động (initiative)
- Lưới: 7 × 3. Phe ta 3 cột trái (0..2); giữa là cột 3; phe địch 4..6.
- Thứ tự 1→9 cho mỗi phe tuân theo sơ đồ ảnh tham chiếu đã gửi (chuẩn chiến thuật lane). SPD không đổi thứ tự này.
- Ta sẽ lưu một mảng ORDER_ALLY[1..9] và ORDER_ENEMY[1..9] để AI hiểu “điểm rơi” sớm/muộn của từng vị trí.

2) Bộ chỉ số (10 chỉ số)
- 8 core: HP, ATK, ARM(DEF), RES, PER, AGI, SPD, WIL.
- 2 Aether: AEmax, AEregen/s.
- CDR (nếu dùng) có thể nằm riêng theo hệ kỹ năng; không bắt buộc luôn có.
- Rank Multiplier (áp lên TẤT CẢ chỉ số trừ SPD): N:0.8, R:0.9, SR:1.05, SSR:1.25, UR:1.5, Prime:1.8. (đã điều chỉnh để giảm chênh lệch cơ bản giữa các bậc)
- SPD KHÔNG nhân theo bậc và không đổi thứ tự hành động theo ô; SPD chỉ ảnh hưởng follow‑up trong chính lượt của ô đó.

3) SPD = nhịp follow‑up (không chen turn)
- Ở lượt của một ô, đơn vị có SPD tạo ngân sách follow‑up = max(0, SPD − 1).
- Mỗi follow‑up = 1 cú đánh thường/cast nhanh sau khi hành động chính kết thúc (khoảng trễ animation nhỏ).
- Giới hạn: tối đa 2 follow‑up/lượt để tránh spam (trừ khi kỹ năng/trait nói khác).
- Ví dụ: SPD 1.30 ⇒ ngân sách 0.30 ⇒ 30% cơ hội (tích luỹ) cho 1 follow‑up; SPD 1.20 ⇒ 20%; SPD 1.05 ⇒ 5%.
  (Tuỳ tuning có thể dùng cơ chế “mỗi X lượt chắc chắn 1 lần” thay cho RNG thuần.)
- SPD không làm thay đổi lượt giữa các ô, cũng không nâng một ô nhảy trước ô khác.

4) SPD base theo Class (đã CHỈNH theo yêu cầu)
- Assassin (Sát thủ): 1.30  — cao nhất.
- Ranger:               1.20
- Summoner (Triệu hồi): 1.15
- Mage (Pháp sư):       1.10
- Warrior (Chiến sĩ):   1.10 ← đã tăng.
- Support (Hỗ trợ):     1.05
- Tanker:               1.00  ← đã giảm. (thấp hơn Warrior)

5) Vai trò & hành vi tổng quát theo Class
- Tanker: ưu tiên ô “đỡ đòn sớm”, đứng front (cột gần midline); +điểm nếu che cho unit tầm xa.
- Warrior: đánh gần đa dụng; chọn ô sớm‑vừa, cân bằng an toàn & áp lực; lấp lane trống trước, ưu tiên hàng mid.
- Assassin: tìm mục tiêu mềm (HP/ARM thấp), vào các ô có hành động sớm và đường ngắn đến mục tiêu; né cụm tanker dày.
- Ranger: chọn ô an toàn hơn (xa midline, back > mid > front), ưu tiên lane có tầm bắn thông thoáng; tránh trùng hàng với nhiều tanker địch.
- Mage: giữ khoảng cách, ưu tiên xa midline; +điểm nếu có nhiều mục tiêu thẳng hàng (gợi ý AOE/line); tránh ô bị áp sát dễ bị “interrupt”.
- Support: cộng điểm cho ô gần đồng minh cần heal/buff; tránh ô sớm nếu không có tanker che.
- Summoner: thả minion “đỡ” trước; Back > Mid > Front để an toàn; khi lane thiếu tanker ⇒ cộng điểm cho front lane đó.

6) Khung Aether/Nộ
- AEmax: dung lượng nộ; AEregen/s: tốc nạp (mặc định ~0.5–1.5 tuỳ class).
- Đánh thường/certain skill sinh AE; bị đánh sinh AE giảm bớt (để tránh snowball quá nhanh).
- Ultimate yêu cầu AE đầy; cast xả AE về 0 (hoặc phần trăm).

7) AI bot địch — lịch & cách chọn
- Tick vào sân: 7.5s kể từ khi timer 4:00 bắt đầu.
- Lặp: 3s, 4s, 3s, 4s, … đến hết trận.
- Mỗi tick:
  1) Lọc các unit địch có cost ≤ cost hiện tại.
  2) Chọn Class theo “nhu cầu đội hình”: thiếu tanker/midline ⇒ +điểm cho Tanker/Warrior; bị dồn lane top ⇒ +điểm ô top tương ứng…
  3) Scoring ô đặt = w1*AN_TOAN + w2*AP_LUC + w3*PHU_HOP_CLASS + w4*UU_TIEN_LAN (sớm/muộn theo ORDER_*).
  4) Tie‑break: ưu tiên cost rẻ hơn (để duy trì nhịp), sau đó ưu tiên class đang thiếu trong đội hình.
- Bảo đảm không đặt trùng ô đã chiếm và không vượt quá giới hạn “ally slots”/lane nếu có.

8) Đồng bộ với file “các lưu ý…” (Cly)
- Cly có một số số liệu phạm vi rộng, dùng để tham khảo tuning cao/thấp. Khi khác biệt:
  - SPD: theo bảng ở (4) của file này — Tanker thấp hơn Assassin, và thấp hơn Warrior; Warrior = 1.10, Tanker = 1.00.
  - Rank Multiplier: theo (2) của file này, KHÔNG nhân vào SPD.
- Nếu cần map tên chỉ số giữa hai tài liệu: ARM=DEF vật lý, RES=kháng phép, PER=(độ chính xác/penetration tuỳ triển khai), AGI=(né/tránh).

9) Ghi chú implement
- PR‑2a: dựng AI summon địch theo lịch 7.5s → 3/4s, cơ chế scoring ô, không cần chiến đấu.
- PR‑2b: tích hợp 8 core + 2 AE vào thực thể unit, cập nhật UI (HP bar, AE bar), và mang SPD‑followup vào combat loop.
- PR‑2c: mở rộng trait/skill từng class và Ultimate.

Kết thúc — v0.6.2c (đã sửa SPD: Warrior 1.10; Tanker 1.00)
